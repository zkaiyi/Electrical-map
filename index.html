<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/nav-02.css" />
    <link rel="stylesheet" href="css/index.css" />
    <!--<script type="text/javascript" src="http://api.map.baidu.com/api?key=&v=1.1&services=true"></script>-->
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=6GDWC6jN5fYeiAVvDxqtcxs4AVlKjR11"></script>
    <title>首页</title>
</head>
<body>
<div class="container" id="app">
    <!--固定头部菜单栏目-->
    <div class="top-nav clearfix">
        <div class="top-nav-fl fl"><img class="top-nav-fl-img" src="images/logo.jpg" />宁波电商城海曙园区信息统计系统</div>
        <div class="top-nav-fr fr" id="close"><img class="top-nav-fr-img" src="images/close.png" />关闭本页</div>
    </div>
    <!--固定左边菜单栏目-->
    <div class="left-nav">
        <div class="left-nav-container">

            <div class="nav nav-a nav-a1"><a href="index.html">
                <div class="nav-t1"><img class="nav-t1-img" src="images/nav-01-a.png" /></div>
                <div class="nav-t2">首页</div>
            </a></div>
            <div class="nav"><a href="nav-02.html">
                <div class="nav-t1"><img class="nav-t1-img" src="images/nav-02.png" /></div>
                <div class="nav-t2">电商企业</div>
            </a></div>
            <div class="nav"><a>
                <div class="nav-t1"><img class="nav-t1-img" src="images/nav-03.png" /></div>
                <div class="nav-t2">服务外包企业</div>
            </a></div>
            <div class="nav"><a>
                <div class="nav-t1"><img class="nav-t1-img" src="images/nav-04.png" /></div>
                <div class="nav-t2">软件和信息技术服务业</div>
            </a></div>
            <div class="nav"><a>
                <div class="nav-t1"><img class="nav-t1-img" src="images/nav-05.png" /></div>
                <div class="nav-t2">其他企业</div>
            </a></div>

        </div>
    </div>
    <!--主要内容-->
    <div class="main">
        <div class="map">
            <div id="dituContent"></div>
        </div>
        <!--漂浮窗-->
        <div class="Floating">
            <div class="Floating-l">
                <!--头部类型-->
                <div class="Floating-title clearfix">
                    <!--<div class="Floating-title-01 Floating-title-01- fl Floating-title-01-a">电商企业<br>(255)</div>-->
                    <!--<div class="Floating-title-01 Floating-title-02- fl">服务外包企业<br>(120)</div>-->
                    <!--<div class="Floating-title-01 Floating-title-03- fl">软件服务技术<br>(50)</div>-->
                    <!--<div class="Floating-title-01 Floating-title-04- fl">其他<br>(85)</div>-->
                </div>

                <!--商圈销售总额分析-->
                <div class="area-table">
                    <div class="area-table-title">各商圈销售总额分析</div>
                    <div id="table02"></div>
                </div>

                <!--商圈税额占比分析图-->
                <div class="se-table">
                    <div class="se-table-title">各商圈税额占比分析图</div>
                    <div id="table03" style="height: 100%"></div>
                </div>
            </div>
        </div>
        <!--漂浮窗 结束-->
        <!--展示名片-->

        <!--展示名片 结束-->
    </div>
</div>



<script src="js/jquery.min.js"></script>
<script src="js/bane.js"></script>
<script src="js/echarts.min.js"></script>

<script>

</script>
<!--商圈税务-->
<script>
    var dom = document.getElementById("table03");
    var myChart = echarts.init(dom);
    var app = {};
    option = null;
    app.title = '环形图';

    option = {
        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b}: {c} ({d}%)"
        },
        legend: {
            orient: 'vertical',
            x: 'right'
            // data:['工程（技术）中心','重点实验室','科技企业孵化室','众创空间','工程中心','搜索引擎']
        },
        series: [
            {
                name:'税额占比',
                type:'pie',
                radius: ['40%', '60%'],
                avoidLabelOverlap: false,
                label: {
                    normal: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        show: true,
                        textStyle: {
                            fontSize: '16',
                            fontWeight: 'bold'
                        }
                    }
                },
                labelLine: {
                    normal: {
                        show: false
                    }
                },
                data:[
                    {value:335, name:'工程（技术）中心'},
                    {value:310, name:'重点实验室'},
                    {value:234, name:'科技企业孵化室'},
                    {value:135, name:'众创空间'},
                    {value:748, name:'工程中心'},
                    {value:748, name:'搜索引擎'},
                ]
            }
        ]
    };
    ;
    if (option && typeof option === "object") {
        myChart.setOption(option, true);
    }
</script>
<script>
    // 销售总额点击
    $(document).on("click",".list-02-t",function () {
        if($(this).find(".span-01").hasClass("span-01a")){
            $(this).find(".span-01").removeClass("span-01a");
            $(this).siblings().find(".span-01").addClass("span-01a");
        }else {
            $(this).find(".span-01").addClass("span-01a");
            $(this).siblings().find(".span-01").removeClass("span-01a");
        }
    });
    // 销售总额下拉
    $(document).on("click",".list-01",function () {
       if($(this).siblings().hasClass("hide")){
           $(this).siblings().slideDown();
           $(this).siblings().removeClass("hide");
       }else {
           $(this).siblings().slideUp();
           $(this).siblings().addClass("hide");
       }
    });
    // 季度表表选择年份
    function choose01() {
        if($(".show-table-content-02-title-fl-t1").siblings().hasClass("hide")){
            $(".show-table-content-02-title-fl-t1").siblings().slideDown();
            $(".show-table-content-02-title-fl-t1").siblings().removeClass("hide");
        }else {
            $(".show-table-content-02-title-fl-t1").siblings().slideUp();
            $(".show-table-content-02-title-fl-t1").siblings().addClass("hide");
        }
    }
</script>
<script src="js2/url.js"></script>
<script src="js2/index.js"></script>
<!--地图-->
<script type="text/javascript">
    var map = new BMap.Map("dituContent");          // 创建地图实例
    var point = new BMap.Point(121.530437, 29.903015); // 创建点坐标
    map.centerAndZoom(point, 17);                 // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放

    var styleJson ="";
    $.ajax({
        url:"js2/custom_map_config.json",
        type:"get",
        async:false,
        success:function (res00) {
            console.log(res00);
            styleJson =res00;
        },
        error:function () {
            
        }
    });

    map.setMapStyleV2({styleJson:styleJson});



    // var mapType1 = new BMap.MapTypeControl(
    //     {
    //         mapTypes: [BMAP_NORMAL_MAP,BMAP_HYBRID_MAP],
    //         anchor: BMAP_ANCHOR_TOP_LEFT
    //     }
    // );
    // map.addControl(mapType1);
    // map.setCurrentCity("宁波市");

    map.addControl(new BMap.MapTypeControl({
        mapTypes:[
            BMAP_NORMAL_MAP,
            BMAP_HYBRID_MAP
        ],
        anchor: BMAP_ANCHOR_TOP_LEFT
    }));
    map.setCurrentCity("北京");









    // 区域划分覆盖物取点
    // 区域划分覆盖点
    $.ajax({
        type: "get",
        url: callurl + "Company/GetBusinessArea?nodeCode=100010008",
        success: function (res) {
            console.log(res);
            var point = [];
            // var marker = [];
            var ids = [];
            for(var i = 0;i<res.length;i++){
                // 颜色
                var color = res[i].strokeColor;

                // 里面的点
                var innerPoint = res[i].innerPoint;
                var innerP = [];
                var myIcon = new BMap.Icon("images/mark.png", new BMap.Size(28,28));
                for(var l=0;l<innerPoint.length;l++){
                    var innerP0 = new BMap.Point(innerPoint[l].long,innerPoint[l].lat);
                    var marker = new BMap.Marker(innerP0,{icon:myIcon},"1");

                }
                marker.customData = {"sqid":res[i].id};
                map.addOverlay(marker);           // 将标注添
                console.log(marker);
                marker.addEventListener('click',function(e){
                    var point_n = new BMap.Point(e.point.lng,e.point.lat);
                    var id = e.target.customData.sqid;

                    getinform(id,point_n);


                });


                // 商圈轮廓
                var ltPoints =  res[i].maginPoints;
                var polygon =[];

                for(var j=0;j<ltPoints.length;j++){
                    var polygon0 = new BMap.Point(ltPoints[j].long,ltPoints[j].lat);
                    polygon.push(polygon0);

                }
                var ids0 = res[i].id;
                ids.push(ids0);
                var Poly = new BMap.Polygon(polygon, {fillColor:color,strokeColor:"#fff", strokeWeight:2, strokeOpacity:0.4});
                Poly.customData = {"sqid":res[i].id};
                map.addOverlay(Poly);
                Poly.addEventListener('click',function(e){
                    var point_n = new BMap.Point(e.point.lng,e.point.lat);
                    console.log(e.target.customData.sqid);
                    // console.log(e.customData.sqid);
                    var id = e.target.customData.sqid;

                    getinform(id,point_n);
                    console.log(point_n);
                });
                console.log(Poly);



            }
            console.log(ids);


        },
        error:function (xml) {
            console.log(xml);
        }
    });

    // 政策申报表下拉
    function zcxl(id,type) {
        var json02 = {
            ssid:id
        };
        if(type){
            json02.type = type
        }
        console.log(json02);


        if(type == "1"){
            $(".zsbje-dw").html("元")
        }
        if(type == "0"){
            $(".zsbje-dw").html("万元")
        }




        $.ajax({
            url:callurl + "Company/GetSSReportYearSelect",
            type:"post",
            data:json02,
            async:false,
            success:function (res03) {

                $("#cznf").html("");
                console.log(res03);
                var yearList = res03.yearList;
                // var btList = res03.typeResult;
                sessionStorage.setItem("zcxldate",yearList[yearList.length-1]);
                for(var i=yearList.length-1;i>=0;i--){
                    var children02='<div class="show-table-content-03-t1-fl-t1-t" onclick="choose04(this)" data-yearID="'+yearList[i]+'" data-chooesID="'+id+'">'+yearList[i]+'年</div>';
                    $("#cznf").append(children02);
                }



            },
            error:function (xml) {
                console.log(xml);
            }
        });
    }
    // 信息窗
    function getinform(id,point) {

        // var id="1000100080001";

        $.ajax({
            url: callurl + "Company/GetSCInfo/" + id,
            type: "post",
            success: function (res) {
                console.log(res);
                var children = "";


                // 季度报表下拉
                $.ajax({
                    url:callurl + "Company/GetSCJEYearList/" + id,
                    type:"post",
                    async:false,
                    success:function (res02) {
                        console.log(res02);
                        var res02 = res02.yearList;
                        for(var i=res02.length-1;i>=0;i--){
                            children +='<div class="s-t-c-0-t-f-t-t" onclick="choose02(this)" data-yearID="'+res02[i]+'" data-chooesID="'+id+'">'+res02[i]+'年</div>';
                        }
                    },
                    error:function (xml) {
                        console.log(xml);
                    }
                });



                // 信息窗口
                var sContent='<div class="show">\n' +
                    '            <div class="show-container">\n' +
                    '                <div class="show-title">'+res.scName+'</div>\n' +
                    '                <div class="show-t2 clearfix">\n' +
                    '                    <div class="show-t2-fl fl"><img class="show-t2-fl-img" src="http://hsds.haishu.gov.cn/xtsz/UploadFile/images/'+res.picPath+'"  onerror="this.src=\'images/index-map01.jpg\'"/></div>\n' +
                    '                    <div class="show-t2-fr fl">\n' +
                    '                        <div class="show-t2-fr-01" title="'+res.scName+'">商圈名称：'+res.scName+'</div>\n' +
                    '                        <div class="show-t2-fr-01" title="'+res.simple+'">商圈简介：'+res.simple+'</div>\n' +
                    '                        <div class="show-t2-fr-01" title="'+res.address+'">商圈位置：'+res.address+'</div>\n' +
                    '                        <div class="show-t2-fr-01">销售总额：'+res.hj+'</div>\n' +
                    '                        <div class="show-t2-fr-01">纳税总额：'+res.lshj+'</div>\n' +
                    '                    </div>\n' +
                    '                </div>\n' +
                    '                <div class="show-table">\n' +
                    '                    <div class="show-table-title clearfix">\n' +
                    '                        <div class="show-table-title-fl show-table-title-fl-a fl" id="jdbb" onclick="tabs02()" data-id="'+id+'">季度报表</div>\n' +
                    '                        <div class="show-table-title-fl fl" id="zcsbb" onclick="tabs03()" data-id="'+id+'">政策申报表</div>\n' +
                    '                    </div>\n' +
                    '                    <div class="show-table-content">\n' +
                    '\n' +
                    '                        <!--季度报表-->\n' +
                    '                        <div class="show-table-content-02" id="jdbb_c">\n' +
                    '                            <div class="show-table-content-02-title clearfix">\n' +
                    '                                <!--<div class="show-table-content-02-title-fl fl">各企业类型第X季度销售总额分析</div>-->\n' +
                    '                                <div class="show-table-content-02-title-fr  fr">\n' +
                    '                                    <div class="show-table-content-02-title-fl-t1" onclick="choose01()"><span class="span-02">年份</span><img class="show-table-content-02-title-fl-t1-img" src="images/index-down.png" /></div>\n' +
                    '                                    <div class="show-table-content-02-title-fl-t2 hide">'+children+'</div>\n' +
                    '                                </div>\n' +
                    '                            </div>\n' +
                    '                            <div class="show-table-content-02-main">\n' +
                    '                                <div id="main"></div>\n' +
                    '                            </div>\n' +
                    '                        </div>\n' +
                    '                        <!--政策申报表-->\n' +
                    '                        <div class="show-table-content-03 hide" id="zcsbb_c">\n' +
                    '                            <div class="show-table-content-03-t1 clearfix">\n' +
                    '                                <!--年份-->\n' +
                    '                                <div class="show-table-content-03-t1-fl fl">\n' +
                    '                                    <div class="show-table-content-03-t1-fl-t" onclick="choose03(this)"><span class="span-03">年份</span><img class="show-table-content-03-t1-fl-t-img" src="images/index-down.png" /></div>\n' +
                    '                                    <div class="show-table-content-03-t1-fl-t1 hide" id="cznf"></div>\n' +
                    '                                </div>\n' +
                    '                                <!--财政补贴-->\n' +
                    '                                <div class="show-table-content-03-t1-fl fl">\n' +
                    '                                    <div class="show-table-content-03-t1-fl-t" onclick="choose03(this)"><span class="span-03">财政补贴</span><img class="show-table-content-03-t1-fl-t-img" src="images/index-down.png" /></div>\n' +
                    '                                    <div class="show-table-content-03-t1-fl-t1 hide">\n' +
                    '                                        <div class="show-table-content-03-t1-fl-t1-t" onclick="choose05(this)" data-id="'+id+'" data-type="0">财政补贴</div>\n' +
                    '                                        <div class="show-table-content-03-t1-fl-t1-t" onclick="choose05(this)" data-id="'+id+'" data-type="1">房租补贴</div>\n' +
                    '                                    </div>\n' +
                    '                                </div>\n' +
                    '                                <!--完税证明-->\n' +
                    '                                <div class="show-table-content-03-t2-fl fl">总申报金额：  <span id="zsbje"></span><span class="zsbje-dw">万元</span></div>\n' +
                    '                            </div>\n' +
                    '                            <div class="show-table-content-03-t2 clearfix">\n' +
                    '                                <div id="main02"></div>\n' +
                    '\n' +
                    '                            </div>\n' +
                    '                        </div>\n' +
                    '                    </div>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>'

                var infoWindow = new BMap.InfoWindow(sContent);// 创建信息窗口对象
                // map.openInfoWindow(infoWindow, map.getCenter());      // 打开信息窗口
                map.openInfoWindow(infoWindow,point);      // 打开信息窗口

                // 季度报表初始化
                setTimeout(function () {
                    earchts(id)
                },10)


            },
            error:function (xml) {
                console.log(xml)
            }
        });






    }
</script>
<script>
    // 表格分析
    function earchts(yearId,year) {
        var myChart = echarts.init(document.getElementById('main'));
        app.title = '坐标轴刻度与标签对齐';
        option = {
            color: ['#3398DB'],
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    data : ['第一季度', '第二季度', '第三季度', '第四季度'],
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                // {
                //     name:'直接访问',
                //     type:'bar',
                //     barWidth: '60%',
                //     data:[10, 52, 200, 334]
                // }
            ]
        };

        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }


        var json = {

        };
        if(yearId){
            json.id=yearId;
        }

        if(year){
            json.year=year;
        }

        console.log(json);
        $.ajax({
            url:callurl + "Company/GetSCJEHJList",
            type:"post",
            data:json,
            success:function(res021) {
                console.log(res021);
                myChart.setOption({
                    series : [
                        {
                            name:'销售额',
                            type:'bar',
                            barWidth: '60%',
                            data:res021.hjList
                        },
                        {
                            name:'税额',
                            type:'line',
                            data:res021.lshjList
                        }
                    ]
                });



            },
            error:function (xml021) {
                console.log(xml021)
            }

        })








    }




    function earchts02(yearId,year,type) {

        var myChart02 = echarts.init(document.getElementById('main02'));

        option02 = {
            color: ['#3398DB'],
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    data : [],
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                // {
                //     name:'直接访问',
                //     type:'bar',
                //     barWidth: '60%',
                //     data:[10, 52, 200, 334]
                // }
            ]
        };

        if (option02 && typeof option02 === "object") {
            myChart02.setOption(option02, true);
        }

        var json04 = {}
        if(yearId){
            json04.ssid=yearId;
        }

        if(year){
            json04.year=year;
        }

        if(type){
            json04.type=type;
        }

        console.log()

        $.ajax({
            url:callurl + "Company/GetSSFZReport",
            type:"post",
            data:json04,
            success:function(res021) {
                // 总申报金额
                $("#zsbje").html(res021.sum);


                console.log(res021);
                myChart02.setOption({
                    xAxis : [
                        {
                            data :res021.xzb
                        }
                    ],

                    series : [
                        {
                            name:'税额',
                            type:'line',
                            data:res021.yzb
                        }
                    ]
                });



            },
            error:function (xml021) {
                console.log(xml021)
            }

        })







    }

    // 地图信息窗口点击
    function tabs02() {
        $("#jdbb_c").removeClass("hide");
        $("#jdbb_c").siblings().addClass("hide");
        $("#jdbb").addClass("show-table-title-fl-a");
        $("#jdbb").siblings().removeClass("show-table-title-fl-a");

        var gsid = $("#jdbb").attr("data-id");
        earchts(gsid)
        // earchts02(gsid);

        sessionStorage.removeItem("nf_vaule02");

    }
    function tabs03() {
        $("#zcsbb_c").removeClass("hide");
        $("#zcsbb_c").siblings().addClass("hide");
        $("#zcsbb").addClass("show-table-title-fl-a");
        $("#zcsbb").siblings().removeClass("show-table-title-fl-a");

        var yearId = $("#zcsbb").attr("data-id");

        earchts02(yearId,sessionStorage.getItem("zcxldate"),"0");
        zcxl(yearId,"0");

    }
    // 季度表表
    function choose02(obj) {
        var nf_vaule = $(obj).text();
        $(".span-02").html(nf_vaule);
        $(".span-02").html(nf_vaule);
        $(".show-table-content-02-title-fl-t2").slideUp();
        $(".show-table-content-02-title-fl-t2").addClass("hide");
        var year = $(obj).attr("data-yearID");
        var yearId = $(obj).attr("data-chooesid");
        earchts(yearId,year)
    }
    // 政策申报表选择年份
    function choose03(obj) {
        if($(obj).siblings().hasClass("hide")){
            $(obj).siblings().slideDown();
            $(obj).siblings().removeClass("hide");
        }else {
            $(obj).siblings().slideUp();
            $(obj).siblings().addClass("hide");
        }
    }

    // 点击筛选政策申报表年份
    function choose04(obj) {
        var nf_vaule02 = $(obj).text();
        $(obj).parent().siblings().find("span").html(nf_vaule02);
        $(".show-table-content-03-t1-fl-t1").slideUp();
        $(".show-table-content-03-t1-fl-t1").addClass("hide");

        var year = $(obj).attr("data-yearID");
        var yearId = $(obj).attr("data-chooesid");

        earchts02(yearId);

    }

    function choose05(obj) {
        var nf_vaule02 = $(obj).text();
        sessionStorage.setItem("nf_vaule02",nf_vaule02);
        $(obj).parent().siblings().find("span").html(nf_vaule02);
        $(".show-table-content-03-t1-fl-t1").slideUp();
        $(".show-table-content-03-t1-fl-t1").addClass("hide");


        var id = $(obj).attr("data-id");
        var type = $(obj).attr("data-type");
        earchts02(id,"2017",type);
        zcxl(id,type);


    }




</script>
<script>
    // var qjh = $(window).height();
    // $(".Floating").css("height", 0.7 * qjh + "px" );

</script>
</body>
</html>